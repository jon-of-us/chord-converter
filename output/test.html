
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>test</title>
    <style>
body { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; line-height: 1.4; }
pre { margin: 0.01rem; white-space: pre; }
.heading {font-weight: 700; padding-top: 1rem; padding-bottom: 0.5rem; }
.subheading {font-weight: 400; padding-top: 1rem; }
.section { margin: 0.75rem 0; }
.marker { position: relative; display: inline-block; width: 0; height: 0; overflow: visible; }
.marker > img.chord-icon, .marker > svg.chord-icon { position: absolute; left: 0; bottom: -1.4em; height: 3.2em; overflow: visible; }
.subheading { font-weight: 700; }

/* chord overlay system */
.chord-line { position: relative; }
.chord-line pre.lyrics { position: relative; z-index: 1; }
.chord-markers { position: relative; }

/* invisible markers occupying a zero-width inline-block at chord start */
.chord-marker { width:0; height:0; display:inline-block; position:relative; overflow:visible; }

/* floating chord/word labels rendered in separate absolutely positioned pre elements */
.word-chord { position:absolute; top:0; left:0; margin:0; padding:0; font-weight:600; pointer-events:none; white-space:pre; }
.word-layer { position:absolute; left:0; right:0; top:0; height:0; }

/* allow spacing to avoid overlap with preceding section */
.chord-line-wrapper { position:relative; margin:0; padding:0; }

/* optional debug style (disabled by default) */
/* .chord-marker { outline:2px solid rgba(200,0,0,0.3); } */

</style>
  </head>
  <body>

<div class='heading'>TEST </div>
<div class='chord-line-wrapper'>
<pre class='lyrics chord-markers'><span class='marker chord-marker' id='mk-1-0'><svg class="chord-icon" viewBox="0 0 690.0 1056.0254037844386" data-w="690.0" data-h="1056.0254037844386" xmlns="http://www.w3.org/2000/svg">
  <circle cx="195.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="95.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="595.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="495.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="70" fill="#333333" />
  <circle cx="495.0" cy="614.6152422706632" r="70" fill="#333333" />
  <circle cx="595.0" cy="441.41016151377545" r="70" fill="#333333" />
  <rect x="395.0" y="441.41016151377545" width="0" height="0" fill="#333333" />
  <line x1="395.0" y1="441.41016151377545" x2="495.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
  <line x1="395.0" y1="441.41016151377545" x2="595.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
  <line x1="495.0" y1="614.6152422706632" x2="595.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
</svg></span>  <span class='marker chord-marker' id='mk-1-2'><svg class="chord-icon" viewBox="0 0 690.0 1056.0254037844386" data-w="690.0" data-h="1056.0254037844386" xmlns="http://www.w3.org/2000/svg">
  <circle cx="195.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="95.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="595.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="495.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="70" fill="#333333" />
  <circle cx="495.0" cy="614.6152422706632" r="70" fill="#333333" />
  <circle cx="595.0" cy="441.41016151377545" r="70" fill="#333333" />
  <rect x="395.0" y="441.41016151377545" width="0" height="0" fill="#333333" />
  <line x1="395.0" y1="441.41016151377545" x2="495.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
  <line x1="395.0" y1="441.41016151377545" x2="595.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
  <line x1="495.0" y1="614.6152422706632" x2="595.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
</svg></span>  <span class='marker chord-marker' id='mk-1-4'><svg class="chord-icon" viewBox="0 0 690.0 1056.0254037844386" data-w="690.0" data-h="1056.0254037844386" xmlns="http://www.w3.org/2000/svg">
  <circle cx="195.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="95.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="595.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="495.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="70" fill="#333333" />
  <circle cx="395.0" cy="441.41016151377545" r="70" fill="#333333" />
  <circle cx="495.0" cy="614.6152422706632" r="70" fill="#333333" />
  <rect x="295.0" y="614.6152422706632" width="0" height="0" fill="#333333" />
  <line x1="295.0" y1="614.6152422706632" x2="395.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
  <line x1="295.0" y1="614.6152422706632" x2="495.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
  <line x1="395.0" y1="441.41016151377545" x2="495.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
</svg></span>   <span class='marker chord-marker' id='mk-1-7'><svg class="chord-icon" viewBox="0 0 690.0 1056.0254037844386" data-w="690.0" data-h="1056.0254037844386" xmlns="http://www.w3.org/2000/svg">
  <circle cx="195.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="95.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="595.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="495.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="70" fill="#333333" />
  <circle cx="495.0" cy="614.6152422706632" r="70" fill="#333333" />
  <circle cx="595.0" cy="441.41016151377545" r="70" fill="#333333" />
  <rect x="395.0" y="441.41016151377545" width="0" height="0" fill="#333333" />
  <line x1="395.0" y1="441.41016151377545" x2="495.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
  <line x1="395.0" y1="441.41016151377545" x2="595.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
  <line x1="495.0" y1="614.6152422706632" x2="595.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
</svg></span>  <span class='marker chord-marker' id='mk-1-9'><svg class="chord-icon" viewBox="0 0 690.0 1056.0254037844386" data-w="690.0" data-h="1056.0254037844386" xmlns="http://www.w3.org/2000/svg">
  <circle cx="195.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="95.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="595.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="495.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="70" fill="#333333" />
  <circle cx="395.0" cy="441.41016151377545" r="70" fill="#333333" />
  <circle cx="495.0" cy="614.6152422706632" r="70" fill="#333333" />
  <rect x="295.0" y="614.6152422706632" width="0" height="0" fill="#333333" />
  <line x1="295.0" y1="614.6152422706632" x2="395.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
  <line x1="295.0" y1="614.6152422706632" x2="495.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
  <line x1="395.0" y1="441.41016151377545" x2="495.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
</svg></span>   <span class='marker chord-marker' id='mk-1-12'><svg class="chord-icon" viewBox="0 0 690.0 1056.0254037844386" data-w="690.0" data-h="1056.0254037844386" xmlns="http://www.w3.org/2000/svg">
  <circle cx="195.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="95.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="595.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="495.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="195.0" cy="441.41016151377545" r="70" fill="#333333" />
  <circle cx="295.0" cy="614.6152422706632" r="70" fill="#333333" />
  <circle cx="395.0" cy="441.41016151377545" r="70" fill="#333333" />
  <rect x="195.0" y="441.41016151377545" width="0" height="0" fill="#333333" />
  <line x1="195.0" y1="441.41016151377545" x2="295.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
  <line x1="195.0" y1="441.41016151377545" x2="395.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
  <line x1="295.0" y1="614.6152422706632" x2="395.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
</svg></span>   <span class='marker chord-marker' id='mk-1-15'><svg class="chord-icon" viewBox="0 0 890.0 1056.0254037844386" data-w="890.0" data-h="1056.0254037844386" xmlns="http://www.w3.org/2000/svg">
  <circle cx="195.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="95.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="595.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="495.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="595.0" cy="441.41016151377545" r="70" fill="#333333" />
  <circle cx="695.0" cy="614.6152422706632" r="70" fill="#333333" />
  <circle cx="795.0" cy="441.41016151377545" r="70" fill="#333333" />
  <rect x="595.0" y="441.41016151377545" width="0" height="0" fill="#333333" />
  <line x1="595.0" y1="441.41016151377545" x2="695.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
  <line x1="595.0" y1="441.41016151377545" x2="795.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
  <line x1="695.0" y1="614.6152422706632" x2="795.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
</svg></span>  <span class='marker chord-marker' id='mk-1-17'><svg class="chord-icon" viewBox="0 0 690.0 1056.0254037844386" data-w="690.0" data-h="1056.0254037844386" xmlns="http://www.w3.org/2000/svg">
  <circle cx="195.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="95.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="395.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="595.0" cy="441.41016151377545" r="90" fill="#CCCCCC" />
  <circle cx="495.0" cy="614.6152422706632" r="90" fill="#CCCCCC" />
  <circle cx="295.0" cy="614.6152422706632" r="70" fill="#333333" />
  <circle cx="395.0" cy="441.41016151377545" r="70" fill="#333333" />
  <circle cx="495.0" cy="614.6152422706632" r="70" fill="#333333" />
  <rect x="295.0" y="614.6152422706632" width="0" height="0" fill="#333333" />
  <line x1="295.0" y1="614.6152422706632" x2="395.0" y2="441.41016151377545" stroke="#333333" stroke-width="50" />
  <line x1="295.0" y1="614.6152422706632" x2="495.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
  <line x1="395.0" y1="441.41016151377545" x2="495.0" y2="614.6152422706632" stroke="#333333" stroke-width="50" />
</svg></span></pre>
</div>

<script>
// Align overlay chord words above marker spans
function alignChordWords() {
    const items = document.querySelectorAll('.word-chord');
    items.forEach(el => {
        const markerId = el.getAttribute('data-marker');
        const marker = document.getElementById(markerId);
        if (!marker) return;
        const markerRect = marker.getBoundingClientRect();
        const containerRect = marker.closest('.chord-line-wrapper').getBoundingClientRect();
        const left = markerRect.left - containerRect.left;
        el.style.transform = `translate(${left}px, 0)`; // horizontally align above marker
    });
}

// Shift chord SVGs right to avoid overlap when markers are close together
function alignChordIcons() {
    const lines = document.querySelectorAll('.chord-line-wrapper');
    const GAP = 10; // px minimal horizontal gap between icons (from config)
    lines.forEach(line => {
        const containerRect = line.getBoundingClientRect();
        const markers = Array.from(line.querySelectorAll('.chord-markers .chord-marker'));
        // Consider only markers that contain an SVG chord icon
        const iconMarkers = markers.filter(m => m.querySelector('svg.chord-icon'));
        // Sort by their natural marker position from left to right
        iconMarkers.sort((a, b) => a.getBoundingClientRect().left - b.getBoundingClientRect().left);
        let lastRight = -Infinity;
        iconMarkers.forEach(m => {
            const svg = m.querySelector('svg.chord-icon');
            if (!svg) return;
            // Reset any previous shift so measurement is consistent
            svg.style.transform = 'translateX(0px)';
            const markerLeft = m.getBoundingClientRect().left - containerRect.left;
            const width = svg.getBoundingClientRect().width;
            let desiredLeft = markerLeft;
            if (markerLeft < lastRight + GAP) {
                desiredLeft = lastRight + GAP;
            }
            const shift = desiredLeft - markerLeft;
            if (shift !== 0) {
                // Only shift horizontally; vertical alignment remains via CSS bottom:0
                svg.style.transform = `translateX(${shift}px)`;
            }
            lastRight = desiredLeft + width;
        });
    });
}

function realignAll() {
    alignChordWords();
    alignChordIcons();
}

window.addEventListener('load', realignAll);
window.addEventListener('resize', realignAll);
</script>

</body>
</html>